<!doctype html>
<html lang="Pt-Br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="script.js"></script>
    <title>Perfil </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 
    <script>

      var usuariologado = localStorage.getItem('usuariologado');

      console.log(usuariologado)

    </script>

  </head>
  <body>
    
    <center>

        <div class = "container"></div>
        <img src ="etepdlogo.jpg" style = "width: 500px;">
    </div>
    <br><br><br><br>
    <h4>Suas informações pessoais</h4>
    <p>Para alterações preencha o campo que você quer alterar e clique em salvar</p>

    </center>
    
    <br><br>
  
    <div class = "container">
    
    <form class="row g-3" id="atualizarperfil">

        <div class="mb-3">
            <label for="formFile" class="form-label">Insira sua foto se desejar</label>
            <input class="form-control" type="file" id="formFile">
          </div>

        <div class="col-md-6">
          <label for="perfilemail" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" placeholder="seuemail@etepd.com" disabled>
        </div>
        <div class="col-md-6">
          <label for="perfilpassword" class="form-label">Senha</label>
          <input type="password" class="form-control" id="perfilpassword">
        </div>

        <div class="col-12">
            <label for="perfilphone"> Telefone com DDD </label>
            <input type="tel" id="perfilphone" name="phone" placeholder="81912345678" required/>

        <div class="col-12">
          <label for="perfilendereco" class="form-label">Endereço</label>
          <input type="text" class="form-control" id="perfilendereco" placeholder="Rua dos Bobos nº 0" required>
        </div>
    
        <div class="col-12">
          <label for="perfilcomplemento" class="form-label">Complemento</label>
          <input type="text" class="form-control" id="perfilcomplemento" placeholder="Apartamento, Bloco, Quadra..." required>
        </div>
        <div class="col-md-6">
          <label for="perfilcidade" class="form-label">Cidade</label>
          <input type="text" class="form-control" id="perfilcidade">
        </div>
        <div class="col-md-4">
          <label for="perfilestado" class="form-label">Estado</label>
          <input type="text" class="form-control" id="perfilestado" placeholder="Pernambuco" disabled>
          </select>
        </div>
        <div class="col-md-2">
          <label for="perfilcep" class="form-label">CEP</label>
          <input type="text" class="form-control" id="perfilcep" required>
        </div>
        <div class="col-6">
            <button type="submit" class="btn btn-primary" onclick="attcadastro()">Salvar alterações</button>
            </label>        
        
          </div>
          <br>
          <div class="col-6">
            <a class="btn btn-primary" href="main.html" role="button">Voltar</a>
          </div>

        </div>
    
      </form>

      <script>

          function attcadastro() {

                    let db = JSON.parse(localStorage.getItem('db')) || [];

                        
                                  for(let user of db) {

                                    if(user.email === usuariologado) {

                                      user.password = document.getElementById('perfilpassword').value;
                                      user.phone = document.getElementById('perfilphone').value;
                                      user.endereco = document.getElementById('perfilendereco').value;
                                      user.cidade = document.getElementById('perfilcidade').value;
                                      user.estado = document.getElementById('perfilestado').value;
                                      user.cep = document.getElementById('perfilcep').value;
                                      user.complemento = document.getElementById('perfilcomplemento').value;
                                
                                      localStorage.setItem('db', JSON.stringify(db));

                                      console.log(user.password);

                                      alert('Cadastro Atualizado!'); 
                                      window.location.assign("main.html"); 
                                      return 'Voltando à página principal';
                                      
                                      }

                                      else {

                                      alert('Erro! Usuário Deslogado, entre novamente na plataforma'); 
                                      window.location.assign("index.html"); 
                                      return 'Voltando ao Login'
                                            }
                                        }                                  
                                    }     

        </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>